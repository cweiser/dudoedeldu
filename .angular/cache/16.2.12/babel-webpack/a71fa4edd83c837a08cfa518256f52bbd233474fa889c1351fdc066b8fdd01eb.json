{"ast":null,"code":"import _asyncToGenerator from \"/Users/christof.weiser/Library/CloudStorage/OneDrive-adessoGroup/Documents/Jessi/p2p-angular-starter/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport * as Y from 'yjs';\nimport { WebrtcProvider } from 'y-webrtc';\nimport * as QRCode from 'qrcode';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nconst _c0 = [\"qrCanvas\"];\nlet AppComponent = /*#__PURE__*/(() => {\n  class AppComponent {\n    constructor() {\n      this.doc = new Y.Doc();\n      this.sharedTextContent = '';\n      this.roomName = '';\n    }\n    ngOnInit() {\n      const params = new URLSearchParams(window.location.search);\n      this.roomName = params.get('room') || 'p2p-shared-text-room';\n      this.connectToRoom(this.roomName);\n    }\n    ngAfterViewInit() {\n      this.generateQRCode(this.roomName);\n    }\n    connectToRoom(room) {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        _this.provider = new WebrtcProvider(room, _this.doc);\n        _this.yText = _this.doc.getText('shared-text');\n        _this.sharedTextContent = _this.yText.toString();\n        _this.yText.observe(() => {\n          const updated = _this.yText.toString();\n          if (updated !== _this.sharedTextContent) {\n            _this.sharedTextContent = updated;\n          }\n        });\n        _this.generateQRCode(room);\n      })();\n    }\n    reconnectToRoom() {\n      this.provider.destroy();\n      this.doc = new Y.Doc();\n      this.connectToRoom(this.roomName);\n      const newUrl = `${window.location.origin}${window.location.pathname}?room=${encodeURIComponent(this.roomName)}`;\n      window.history.replaceState({}, '', newUrl);\n    }\n    updateSharedText() {\n      if (this.sharedTextContent !== this.yText.toString()) {\n        this.yText.delete(0, this.yText.length);\n        this.yText.insert(0, this.sharedTextContent);\n      }\n    }\n    generateQRCode(room) {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        const canvas = _this2.qrCanvas?.nativeElement;\n        const url = `${window.location.origin}${window.location.pathname}?room=${encodeURIComponent(room)}`;\n        if (canvas) {\n          yield QRCode.toCanvas(canvas, url);\n        }\n      })();\n    }\n    static {\n      this.ɵfac = function AppComponent_Factory(t) {\n        return new (t || AppComponent)();\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: AppComponent,\n        selectors: [[\"app-root\"]],\n        viewQuery: function AppComponent_Query(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵviewQuery(_c0, 5);\n          }\n          if (rf & 2) {\n            let _t;\n            i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.qrCanvas = _t.first);\n          }\n        },\n        decls: 13,\n        vars: 2,\n        consts: [[1, \"p-4\", \"max-w-xl\", \"mx-auto\"], [1, \"text-2xl\", \"font-bold\", \"mb-4\"], [1, \"mb-4\"], [1, \"block\", \"text-sm\", \"font-medium\", \"mb-1\"], [1, \"p-2\", \"border\", \"rounded\", \"w-full\", 3, \"ngModel\", \"ngModelChange\", \"change\"], [\"qrCanvas\", \"\"], [1, \"text-sm\", \"text-gray-600\", \"mt-1\"], [\"rows\", \"10\", \"placeholder\", \"Schreibe etwas und teile es mit anderen...\", 1, \"w-full\", \"p-2\", \"border\", \"rounded\", \"shadow\", 3, \"ngModel\", \"ngModelChange\", \"input\"]],\n        template: function AppComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"div\", 0)(1, \"h1\", 1);\n            i0.ɵɵtext(2, \"\\uD83E\\uDDE0 Shared Notes (P2P via Yjs)\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(3, \"div\", 2)(4, \"label\", 3);\n            i0.ɵɵtext(5, \"Raumname:\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(6, \"input\", 4);\n            i0.ɵɵlistener(\"ngModelChange\", function AppComponent_Template_input_ngModelChange_6_listener($event) {\n              return ctx.roomName = $event;\n            })(\"change\", function AppComponent_Template_input_change_6_listener() {\n              return ctx.reconnectToRoom();\n            });\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(7, \"div\", 2);\n            i0.ɵɵelement(8, \"canvas\", null, 5);\n            i0.ɵɵelementStart(10, \"p\", 6);\n            i0.ɵɵtext(11, \"Scanne den QR-Code oder teile den Link, um beizutreten.\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(12, \"textarea\", 7);\n            i0.ɵɵlistener(\"ngModelChange\", function AppComponent_Template_textarea_ngModelChange_12_listener($event) {\n              return ctx.sharedTextContent = $event;\n            })(\"input\", function AppComponent_Template_textarea_input_12_listener() {\n              return ctx.updateSharedText();\n            });\n            i0.ɵɵelementEnd()();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(6);\n            i0.ɵɵproperty(\"ngModel\", ctx.roomName);\n            i0.ɵɵadvance(6);\n            i0.ɵɵproperty(\"ngModel\", ctx.sharedTextContent);\n          }\n        },\n        dependencies: [i1.DefaultValueAccessor, i1.NgControlStatus, i1.NgModel],\n        styles: [\"textarea[_ngcontent-%COMP%]{font-family:monospace;resize:vertical}\"]\n      });\n    }\n  }\n  return AppComponent;\n})();\nexport { AppComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}